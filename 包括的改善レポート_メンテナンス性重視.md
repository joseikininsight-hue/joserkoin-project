# Grant Insight Perfect 包括的改善レポート（メンテナンス性重視版）

**作成日**: 2025-10-25  
**対象サイト**: https://joseikin-insight.com/  
**テーマバージョン**: Grant Insight Perfect v9.1.0  
**分析範囲**: トップページ + 個別助成金ページ + アーカイブページ + 診断ページ + 都道府県ページ

---

## 📋 目次

1. [エグゼクティブサマリー](#エグゼクティブサマリー)
2. [重要度S: CSS/JS管理の抜本的改善](#重要度s-cssjs管理の抜本的改善)
3. [縮小感のある見やすいデザイン仕様](#縮小感のある見やすいデザイン仕様)
4. [ページ別分析](#ページ別分析)
5. [統一デザインシステム](#統一デザインシステム)
6. [実装ガイド](#実装ガイド)
7. [作業優先順位](#作業優先順位)

---

## エグゼクティブサマリー

### 🎯 改善方針

**「余計な機能は追加せず、細部の質を徹底的に高める」**

- ✅ SEOの細かい最適化（h1タグ、メタタグ、構造化データ）
- ✅ 文字の見えやすさ（適切なフォントサイズと行間）
- ✅ デザインバランス（余白、配色、レイアウトの統一）
- ✅ 揃っているか（コンポーネントの一貫性）
- ✅ **メンテナンス性の向上（CSS/JS管理の徹底）**

### 🚨 最重要課題（Critical Issues）

| 優先度 | 課題 | ファイル | 影響度 | 修正時間 |
|--------|------|----------|--------|----------|
| **S** | **681行のインラインCSSを分離** | `page-subsidy-diagnosis.php` | メンテナンス性 | 90分 |
| A | h1タグ重複（SEO影響） | `header.php` | SEO | 15分 |
| A | 基本フォントサイズ14px → 16px | `single-grant.php` | 可読性 | 10分 |
| B | 4つのカラーパレットを統一 | 複数ファイル | デザイン一貫性 | 60分 |
| B | 4つのボタンスタイルを統一 | 複数ファイル | UI一貫性 | 45分 |

### 📊 現状分析サマリー

#### CSS/JS管理の問題点
```
✗ page-subsidy-diagnosis.php: 597行のインラインCSS（85-681行目）
✗ page-subsidy-diagnosis.php: 120行のインラインJS（890-1009行目）
✗ 30+箇所のインラインstyle属性（display:noneなど）
✗ 4つの異なるカラーパレット（style.css, header.php, section-hero.php, single-grant.php）
✗ 4つの異なるボタンスタイル実装
✗ CSS変数の不統一（spacing, typography）
```

#### 良好な点
```
✓ 構造化データの実装が充実（MonetaryGrant, GovernmentService, FAQPageなど）
✓ Open Graph / Twitter Card完備
✓ 適切なalt属性とwidth/height指定
✓ セマンティックなHTML構造
✓ レスポンシブ対応済み
```

---

## 重要度S: CSS/JS管理の抜本的改善

### 🔴 Critical Issue: page-subsidy-diagnosis.php

**現状の問題**:
- **597行のインラインCSS**（85-681行目）がPHPファイル内に埋め込まれている
- **120行のインラインJavaScript**（890-1009行目）が埋め込まれている
- デザインシステム全体（CSS変数、アニメーション、レスポンシブ）が重複
- メンテナンス時に複数箇所を修正する必要がある

#### 現在のコード構造（page-subsidy-diagnosis.php）

```php
<!-- 85-681行目: インラインCSS（597行） -->
<style>
:root {
    --diagnosis-primary: var(--color-black, #000);
    --diagnosis-accent: #ffeb3b;
    --diagnosis-bg: var(--color-white, #fff);
    --diagnosis-text: #333;
    --diagnosis-gray: #666;
    --diagnosis-light-gray: #f5f5f5;
    --diagnosis-border: #e0e0e0;
}

/* 完全なデザインシステムが埋め込まれている */
.diagnosis-hero { /* ... 500行以上のCSS ... */ }
</style>

<!-- 890-1009行目: インラインJavaScript（120行） -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const container = document.getElementById('diagnosis-widget-container');
    // ... 100行以上のJS ...
});
</script>
```

### ✅ 推奨リファクタリング

#### Step 1: CSSを外部ファイル化

**新規作成: `/assets/css/diagnosis-page.css`**

```css
/**
 * 診断ページ専用スタイルシート
 * 
 * 使用ページ: page-subsidy-diagnosis.php
 * 依存関係: style.css（基本変数）
 * 最終更新: 2025-10-25
 */

/* ===================================
   診断ページ専用CSS変数
   =================================== */
:root {
    /* カラーシステム（style.cssの基本変数を継承） */
    --diagnosis-primary: var(--color-black, #000);
    --diagnosis-accent: #ffeb3b;
    --diagnosis-bg: var(--color-white, #fff);
    --diagnosis-text: #333;
    --diagnosis-gray: #666;
    --diagnosis-light-gray: #f5f5f5;
    --diagnosis-border: #e0e0e0;
    
    /* レイアウト変数 */
    --diagnosis-container-max: 1280px;
    --diagnosis-hero-height: clamp(500px, 60vh, 700px);
    
    /* タイポグラフィ変数 */
    --diagnosis-title-size: clamp(32px, 5vw, 56px);
    --diagnosis-subtitle-size: clamp(16px, 2vw, 20px);
    --diagnosis-body-size: 16px;
    --diagnosis-small-size: 13px;
}

/* ===================================
   ヒーローセクション
   =================================== */
.diagnosis-hero {
    position: relative;
    height: var(--diagnosis-hero-height);
    background: linear-gradient(135deg, #000 0%, #1a1a1a 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
}

/* ... 残りのCSSをpage-subsidy-diagnosis.phpから移植 ... */

/* ===================================
   レスポンシブ対応
   =================================== */
@media (max-width: 768px) {
    :root {
        --diagnosis-hero-height: 450px;
    }
    
    .diagnosis-grid {
        grid-template-columns: 1fr;
        gap: var(--space-4, 1rem);
    }
}

@media (max-width: 480px) {
    .diagnosis-widget-container {
        padding: var(--space-3, 0.75rem);
    }
}
```

#### Step 2: JavaScriptを外部ファイル化

**新規作成: `/assets/js/diagnosis-page.js`**

```javascript
/**
 * 診断ページ専用JavaScript
 * 
 * 使用ページ: page-subsidy-diagnosis.php
 * 機能:
 * - iframeウィジェットの読み込み
 * - エラーハンドリング
 * - アナリティクストラッキング
 * 
 * 最終更新: 2025-10-25
 */

(function() {
    'use strict';
    
    /**
     * 診断ウィジェットの初期化
     */
    function initDiagnosisWidget() {
        const container = document.getElementById('diagnosis-widget-container');
        const errorMessage = document.getElementById('diagnosis-error-message');
        const loadingIndicator = document.getElementById('diagnosis-loading');
        
        if (!container) {
            console.error('診断ウィジェットコンテナが見つかりません');
            return;
        }
        
        // iframeの作成
        const iframe = document.createElement('iframe');
        iframe.src = 'https://widget-url.example.com/diagnosis';
        iframe.style.width = '100%';
        iframe.style.height = '600px';
        iframe.style.border = 'none';
        iframe.style.borderRadius = '12px';
        
        // 読み込み完了ハンドラ
        iframe.onload = function() {
            if (loadingIndicator) {
                loadingIndicator.style.display = 'none';
            }
            
            // アナリティクストラッキング
            if (typeof gtag !== 'undefined') {
                gtag('event', 'widget_loaded', {
                    'event_category': 'diagnosis',
                    'event_label': 'widget_iframe'
                });
            }
        };
        
        // エラーハンドラ
        iframe.onerror = function() {
            if (loadingIndicator) {
                loadingIndicator.style.display = 'none';
            }
            if (errorMessage) {
                errorMessage.style.display = 'block';
            }
            
            console.error('診断ウィジェットの読み込みに失敗しました');
        };
        
        container.appendChild(iframe);
    }
    
    /**
     * スムーススクロール
     */
    function initSmoothScroll() {
        const ctaButton = document.querySelector('.diagnosis-cta-button');
        const widgetSection = document.getElementById('diagnosis-widget-section');
        
        if (ctaButton && widgetSection) {
            ctaButton.addEventListener('click', function(e) {
                e.preventDefault();
                widgetSection.scrollIntoView({ 
                    behavior: 'smooth',
                    block: 'start'
                });
            });
        }
    }
    
    /**
     * 初期化
     */
    document.addEventListener('DOMContentLoaded', function() {
        initDiagnosisWidget();
        initSmoothScroll();
    });
    
})();
```

#### Step 3: PHPファイルの修正

**修正: `page-subsidy-diagnosis.php`**

```php
<?php
/**
 * Template Name: 補助金診断ページ
 * 
 * スタイル: /assets/css/diagnosis-page.css
 * スクリプト: /assets/js/diagnosis-page.js
 */

get_header();
?>

<!-- 外部CSSの読み込み -->
<link rel="stylesheet" href="<?php echo get_template_directory_uri(); ?>/assets/css/diagnosis-page.css">

<!-- ページコンテンツ -->
<div class="diagnosis-page">
    <section class="diagnosis-hero">
        <div class="diagnosis-hero-content">
            <h1 class="diagnosis-main-title">
                あなたに最適な<br>
                <span class="diagnosis-accent-text">助成金・補助金</span>を診断
            </h1>
            <p class="diagnosis-subtitle">
                AIが3分で最適な支援制度を見つけます
            </p>
            <button class="diagnosis-cta-button">
                今すぐ無料診断を開始
            </button>
        </div>
    </section>
    
    <!-- ウィジェットセクション -->
    <section id="diagnosis-widget-section" class="diagnosis-widget-section">
        <div id="diagnosis-loading" class="diagnosis-loading">
            読み込み中...
        </div>
        <div id="diagnosis-widget-container" class="diagnosis-widget-container">
            <!-- JavaScriptでiframeを挿入 -->
        </div>
        <div id="diagnosis-error-message" class="diagnosis-error-message" style="display: none;">
            診断ツールの読み込みに失敗しました。ページを再読み込みしてください。
        </div>
    </section>
    
    <!-- 特徴セクション -->
    <section class="diagnosis-features">
        <div class="diagnosis-container">
            <h2 class="diagnosis-section-title">診断の特徴</h2>
            <div class="diagnosis-grid">
                <div class="diagnosis-feature-card">
                    <div class="diagnosis-feature-icon">🎯</div>
                    <h3>AIによる高精度マッチング</h3>
                    <p>あなたの事業内容から最適な支援制度を自動抽出</p>
                </div>
                <div class="diagnosis-feature-card">
                    <div class="diagnosis-feature-icon">⚡</div>
                    <h3>3分で完了</h3>
                    <p>簡単な質問に答えるだけで診断完了</p>
                </div>
                <div class="diagnosis-feature-card">
                    <div class="diagnosis-feature-icon">💰</div>
                    <h3>最大1億円の支援</h3>
                    <p>国・自治体の様々な助成金・補助金を網羅</p>
                </div>
            </div>
        </div>
    </section>
</div>

<!-- 外部JavaScriptの読み込み（defer属性で非同期読み込み） -->
<script src="<?php echo get_template_directory_uri(); ?>/assets/js/diagnosis-page.js" defer></script>

<?php get_footer(); ?>
```

### 📂 推奨ファイル構成

```
/home/user/webapp/
├── assets/
│   ├── css/
│   │   ├── diagnosis-page.css      ← 新規作成（597行のCSSを移植）
│   │   ├── archive-grants.css      ← 今後作成推奨
│   │   ├── single-grant.css        ← 今後作成推奨
│   │   └── components/
│   │       ├── buttons.css         ← 統一ボタンスタイル
│   │       ├── cards.css           ← 統一カードスタイル
│   │       └── forms.css           ← 統一フォームスタイル
│   └── js/
│       ├── diagnosis-page.js       ← 新規作成（120行のJSを移植）
│       ├── archive-filters.js      ← 今後作成推奨
│       └── utils/
│           ├── analytics.js        ← アナリティクス共通処理
│           └── ajax-helpers.js     ← AJAX共通処理
├── style.css                        ← 基本変数とグローバルスタイル
├── page-subsidy-diagnosis.php       ← 修正（インラインCSS/JS削除）
└── inc/
    └── enqueue-scripts.php          ← スクリプト読み込み管理
```

### 🎯 メンテナンス性向上のメリット

#### Before（現状）
```
問題点:
✗ CSSの変更時にPHPファイルを編集する必要がある
✗ 複数ページで同じスタイルを重複記述している可能性
✗ キャッシュが効かない（毎回HTMLに埋め込まれている）
✗ コードレビューがしにくい（PHP + CSS + JSが混在）
✗ 検索性が低い（どこに何のスタイルがあるか分からない）
```

#### After（改善後）
```
メリット:
✓ CSS変更時はCSSファイルのみ編集すればOK
✓ スタイルの再利用が容易
✓ ブラウザキャッシュが効く（ページ読み込み高速化）
✓ 責任分離（PHP: 構造、CSS: スタイル、JS: 振る舞い）
✓ 検索・管理が容易
✓ 複数人での開発がしやすい
✓ Gitでの差分確認が明確
```

---

## 縮小感のある見やすいデザイン仕様

### 🎨 「縮小感 + 見やすさ」の実現

**コンセプト**: 情報密度を高めつつ、可読性とユーザビリティを損なわない

#### 基本方針

1. **フォントサイズ**: 小さくしすぎず、16pxを基本に
2. **行間**: 適度に詰める（1.5-1.6）が、読みやすさは維持
3. **余白**: 必要最小限に（8pxグリッドベース）
4. **情報密度**: カード/リストを詰める、グリッドレイアウト活用
5. **レスポンシブ**: モバイルでは自動調整（clamp()関数活用）

### 📐 タイポグラフィシステム（縮小感重視版）

#### 推奨フォントサイズ

```css
:root {
    /* ===================================
       タイポグラフィシステム（縮小感重視）
       =================================== */
    
    /* 基本サイズ */
    --font-size-base: 16px;              /* 本文（読みやすさ最優先） */
    --line-height-base: 1.5;             /* 行間（通常より詰める） */
    
    /* 見出しサイズ（コンパクト化） */
    --font-size-h1: clamp(28px, 4vw, 36px);   /* 通常より小さめ */
    --font-size-h2: clamp(22px, 3vw, 28px);
    --font-size-h3: clamp(18px, 2.5vw, 22px);
    --font-size-h4: 18px;
    --font-size-h5: 16px;
    --font-size-h6: 14px;
    
    /* 見出し行間（詰める） */
    --line-height-heading: 1.3;          /* 通常1.4-1.5 → 1.3に */
    
    /* UIテキスト（情報密度重視） */
    --font-size-small: 14px;             /* カードのメタ情報など */
    --font-size-xs: 13px;                /* タグ、ラベルなど */
    --font-size-xxs: 12px;               /* 注釈、キャプション */
    
    /* ボタンサイズ（コンパクト化） */
    --font-size-button: 15px;            /* 通常16px → 15pxに */
    --button-padding-y: 10px;            /* 通常12px → 10pxに */
    --button-padding-x: 20px;            /* 通常24px → 20pxに */
}
```

#### Before / After 比較

| 要素 | Before（現状） | After（縮小感重視） | 変更理由 |
|------|----------------|---------------------|----------|
| **h1** | 40-56px | 28-36px | ページタイトルをコンパクトに |
| **h2** | 32-40px | 22-28px | セクション見出しを縮小 |
| **h3** | 24-32px | 18-22px | カード見出しを最適化 |
| **本文** | 14px (single-grant.php) | 16px | 可読性確保（最重要） |
| **小テキスト** | 13-16px | 13-14px | メタ情報をコンパクト化 |
| **行間** | 1.6-1.7 | 1.5 | 情報密度を上げる |
| **ボタン** | 12px padding | 10px padding | UI要素をコンパクトに |

### 📏 スペーシングシステム（縮小感重視版）

```css
:root {
    /* ===================================
       スペーシングシステム（8pxグリッド）
       縮小感を出すため、通常より小さめの値
       =================================== */
    
    --space-0: 0;
    --space-1: 4px;      /* 極小（アイコンとテキストの間など） */
    --space-2: 8px;      /* 小（カード内の要素間） */
    --space-3: 12px;     /* 中小（カードpadding） */
    --space-4: 16px;     /* 中（セクション内の要素間） */
    --space-5: 20px;     /* 中大（カード間のgap） */
    --space-6: 24px;     /* 大（セクション内padding） */
    --space-8: 32px;     /* 特大（セクション間margin） */
    --space-10: 40px;    /* 極大（ページ区切り） */
    --space-12: 48px;    /* 最大（メインセクション間） */
    
    /* コンテナ幅 */
    --container-max-width: 1280px;       /* 通常サイズ */
    --container-narrow: 960px;           /* 狭いコンテンツ用 */
    --container-padding: var(--space-4); /* 16px */
}
```

#### 使用例

```css
/* カードスタイル（縮小感重視） */
.grant-card {
    padding: var(--space-3);              /* 12px（通常16px → 縮小） */
    margin-bottom: var(--space-4);        /* 16px（通常20px → 縮小） */
    border-radius: 8px;                   /* 通常12px → 8px */
}

.grant-card-title {
    font-size: var(--font-size-h3);       /* 18-22px */
    line-height: var(--line-height-heading); /* 1.3 */
    margin-bottom: var(--space-2);        /* 8px */
}

.grant-card-meta {
    font-size: var(--font-size-small);    /* 14px */
    color: var(--color-gray-600);
    margin-bottom: var(--space-2);        /* 8px */
}

/* リストアイテム（情報密度重視） */
.grant-list-item {
    padding: var(--space-3) var(--space-4); /* 12px 16px */
    border-bottom: 1px solid var(--color-gray-200);
}

.grant-list-item:hover {
    background-color: var(--color-gray-50);
}

/* ボタン（コンパクト化） */
.btn-compact {
    padding: var(--space-2) var(--space-4); /* 8px 16px（小さめ） */
    font-size: var(--font-size-button);     /* 15px */
    line-height: 1.4;
}
```

### 🎯 情報密度最適化のテクニック

#### 1. グリッドレイアウトの活用

```css
/* アーカイブページのカードグリッド */
.grants-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); /* 狭めのカード幅 */
    gap: var(--space-4);                /* 16px（通常20-24px → 縮小） */
    padding: var(--space-4);
}

@media (min-width: 768px) {
    .grants-grid {
        grid-template-columns: repeat(2, 1fr);
    }
}

@media (min-width: 1024px) {
    .grants-grid {
        grid-template-columns: repeat(3, 1fr);
        gap: var(--space-5);            /* 20px */
    }
}

@media (min-width: 1280px) {
    .grants-grid {
        grid-template-columns: repeat(4, 1fr); /* 4列で情報密度UP */
    }
}
```

#### 2. カードのコンパクト化

```css
/* コンパクトなカードデザイン */
.grant-card-compact {
    padding: var(--space-3);            /* 12px（通常16-20px） */
    border: 1px solid var(--color-gray-200);
    border-radius: 8px;                 /* 通常12px → 8px */
    transition: all 0.2s ease;
}

.grant-card-compact:hover {
    box-shadow: 0 4px 12px rgba(0,0,0,0.1); /* 軽めのシャドウ */
    transform: translateY(-2px);        /* 控えめなリフト */
}

/* カード内要素の間隔を詰める */
.grant-card-compact > * + * {
    margin-top: var(--space-2);         /* 8px */
}

/* タイトル */
.grant-card-compact__title {
    font-size: var(--font-size-h4);     /* 18px */
    line-height: 1.3;
    font-weight: 600;
    margin-bottom: var(--space-1);      /* 4px */
}

/* メタ情報（コンパクト表示） */
.grant-card-compact__meta {
    display: flex;
    gap: var(--space-2);                /* 8px */
    font-size: var(--font-size-xs);     /* 13px */
    color: var(--color-gray-600);
}

/* タグ（小さめ） */
.grant-card-compact__tag {
    display: inline-block;
    padding: 2px 6px;                   /* 極小padding */
    font-size: var(--font-size-xxs);    /* 12px */
    background: var(--color-gray-100);
    border-radius: 4px;
}
```

#### 3. テーブル・リストの最適化

```css
/* コンパクトなテーブルスタイル */
.grant-table-compact {
    width: 100%;
    font-size: var(--font-size-small);  /* 14px */
    border-collapse: collapse;
}

.grant-table-compact th,
.grant-table-compact td {
    padding: var(--space-2) var(--space-3); /* 8px 12px */
    border-bottom: 1px solid var(--color-gray-200);
    text-align: left;
}

.grant-table-compact th {
    font-weight: 600;
    background: var(--color-gray-50);
    font-size: var(--font-size-xs);     /* 13px */
    color: var(--color-gray-700);
}

/* コンパクトなリストスタイル */
.grant-list-compact {
    list-style: none;
    padding: 0;
    margin: 0;
}

.grant-list-compact__item {
    padding: var(--space-2) 0;          /* 8px上下のみ */
    border-bottom: 1px solid var(--color-gray-200);
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: var(--space-3);                /* 12px */
}

.grant-list-compact__item:last-child {
    border-bottom: none;
}
```

#### 4. レスポンシブタイポグラフィ（clamp活用）

```css
/* デバイスサイズに応じて自動調整 */
.responsive-heading {
    font-size: clamp(18px, 2.5vw, 24px);  /* 小さめの範囲 */
    line-height: 1.3;
}

.responsive-body {
    font-size: clamp(15px, 1.5vw, 16px);  /* 15-16pxで推移 */
    line-height: 1.5;
}

/* モバイルでさらに最適化 */
@media (max-width: 768px) {
    .grant-card {
        padding: var(--space-2);          /* モバイルではさらに縮小 */
    }
    
    .grant-card-title {
        font-size: 16px;                  /* モバイルではh3も16px */
    }
}
```

### 📱 モバイル最適化（縮小感 + タッチ対応）

```css
/* モバイルでの情報密度最適化 */
@media (max-width: 768px) {
    :root {
        /* モバイル専用の小さめサイズ */
        --font-size-h1: 24px;
        --font-size-h2: 20px;
        --font-size-h3: 16px;
        --space-section: 32px;            /* セクション間を詰める */
    }
    
    /* コンテナpadding削減 */
    .container {
        padding-left: var(--space-3);     /* 12px */
        padding-right: var(--space-3);
    }
    
    /* カードをさらにコンパクト化 */
    .grant-card {
        padding: var(--space-2);          /* 8px */
        margin-bottom: var(--space-3);    /* 12px */
    }
    
    /* ただしタッチターゲットは44px以上確保 */
    .btn, .grant-card a {
        min-height: 44px;
        display: flex;
        align-items: center;
        justify-content: center;
    }
}
```

### ✅ 可読性チェックリスト

縮小感を出しつつ、以下の基準を満たす:

- [x] 本文フォントサイズ: **16px以上**（14pxは不可）
- [x] 行間: **1.5以上**（1.4以下は不可）
- [x] タッチターゲット: **44px以上**（モバイル）
- [x] コントラスト比: **4.5:1以上**（WCAG AA）
- [x] 見出しと本文の差: **最低2px以上**
- [x] 段落間の余白: **0.5em以上**

---

## ページ別分析

### 1. トップページ（front-page.php）

#### 現状分析

**構造**:
```php
section-hero.php        // ヒーローセクション
section-search.php      // 検索セクション
section-features.php    // 特徴セクション
section-latest.php      // 最新助成金
section-popular.php     // 人気助成金
section-cta.php         // CTAセクション
```

**色システム**: Black + Yellow Accent (`#ffeb3b`)

**タイポグラフィ（section-hero.php）**:
```css
.gih-title {
    font-size: clamp(32px, 6vw, 64px);
    line-height: 1.2;
}

.gih-description {
    font-size: 17px;           /* ← 16pxに統一推奨 */
    line-height: 1.7;          /* ← 1.5に詰める推奨 */
}
```

#### 改善提案（縮小感重視）

```css
/* トップページ専用調整 */
.gih-title {
    font-size: clamp(28px, 5vw, 48px);    /* 通常より小さめ */
    line-height: 1.2;
    font-weight: 900;
    margin-bottom: var(--space-4);
}

.gih-subtitle {
    font-size: clamp(16px, 2vw, 20px);
    line-height: 1.4;
    color: var(--color-gray-600);
    margin-bottom: var(--space-6);
}

.gih-description {
    font-size: 16px;                       /* 統一 */
    line-height: 1.5;                      /* 詰める */
    max-width: 600px;
    margin: 0 auto;
}

/* CTAボタン（コンパクト化） */
.gih-cta-button {
    padding: var(--space-3) var(--space-6); /* 12px 24px */
    font-size: 15px;                        /* 通常16px → 15px */
    font-weight: 600;
    border-radius: 8px;
}

/* ヒーロー全体の高さを縮小 */
.section-hero {
    min-height: clamp(500px, 60vh, 700px); /* 通常より低く */
    padding: var(--space-10) var(--space-4); /* 40px 16px */
}
```

### 2. 助成金一覧ページ（archive-grant.php）

#### WebFetch分析結果（https://joseikin-insight.com/grants/）

**現状**:
- フィルター機能（カテゴリー、都道府県、市区町村）
- カードグリッドレイアウト（3列）
- ページネーション
- 検索機能

**問題点**:
- 30+箇所のインライン`style="display: none;"`
- 1633行目からインラインJavaScript（フィルター機能）
- カードの余白が大きい（情報密度が低い）

#### 改善提案

##### CSS外部ファイル化: `/assets/css/archive-grants.css`

```css
/**
 * 助成金アーカイブページ専用スタイル
 * 
 * 使用ページ: archive-grant.php, taxonomy-grant_*.php
 * 特徴: 縮小感のある高密度レイアウト
 */

:root {
    /* アーカイブページ専用変数 */
    --archive-card-width: 280px;          /* カード幅（コンパクト） */
    --archive-card-gap: 16px;             /* カード間隔（詰める） */
    --archive-filter-height: 40px;        /* フィルター高さ（低め） */
}

/* ===================================
   フィルターセクション（コンパクト化）
   =================================== */
.grants-filters {
    display: flex;
    gap: var(--space-3);                  /* 12px */
    padding: var(--space-4);              /* 16px */
    background: var(--color-white);
    border-bottom: 1px solid var(--color-gray-200);
    position: sticky;
    top: 0;
    z-index: 100;
}

.filter-select {
    height: var(--archive-filter-height); /* 40px */
    padding: 0 var(--space-3);            /* 0 12px */
    font-size: var(--font-size-small);    /* 14px */
    border: 1px solid var(--color-gray-300);
    border-radius: 6px;                   /* 小さめ */
    background: var(--color-white);
    cursor: pointer;
    flex: 1;
    min-width: 150px;
}

.filter-reset-btn {
    height: var(--archive-filter-height);
    padding: 0 var(--space-4);            /* 0 16px */
    font-size: var(--font-size-small);
    background: var(--color-gray-100);
    border: none;
    border-radius: 6px;
    cursor: pointer;
    white-space: nowrap;
}

.filter-reset-btn:hover {
    background: var(--color-gray-200);
}

/* 動的表示制御（インラインstyle属性を削除） */
.filter-hidden {
    display: none !important;
}

.filter-visible {
    display: block;
}

/* ===================================
   カードグリッド（高密度レイアウト）
   =================================== */
.grants-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(var(--archive-card-width), 1fr));
    gap: var(--archive-card-gap);
    padding: var(--space-4);
}

@media (min-width: 1280px) {
    .grants-grid {
        grid-template-columns: repeat(4, 1fr); /* 4列表示 */
    }
}

/* ===================================
   カードスタイル（縮小感重視）
   =================================== */
.grant-card {
    padding: var(--space-3);              /* 12px */
    border: 1px solid var(--color-gray-200);
    border-radius: 8px;
    background: var(--color-white);
    transition: all 0.2s ease;
    display: flex;
    flex-direction: column;
    height: 100%;
}

.grant-card:hover {
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    transform: translateY(-2px);
}

/* カード内要素の間隔 */
.grant-card > * + * {
    margin-top: var(--space-2);           /* 8px */
}

/* カードタイトル */
.grant-card__title {
    font-size: 16px;                      /* h3相当だがコンパクト化 */
    font-weight: 600;
    line-height: 1.3;
    color: var(--color-gray-900);
    margin: 0 0 var(--space-1) 0;         /* 下margin 4px */
}

.grant-card__title a {
    color: inherit;
    text-decoration: none;
}

.grant-card__title a:hover {
    color: var(--color-primary);
}

/* カードメタ情報 */
.grant-card__meta {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-2);                  /* 8px */
    font-size: var(--font-size-xs);       /* 13px */
    color: var(--color-gray-600);
}

.grant-card__meta-item {
    display: flex;
    align-items: center;
    gap: 4px;
}

/* カードタグ */
.grant-card__tags {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-1);                  /* 4px */
}

.grant-card__tag {
    padding: 2px 6px;                     /* 極小 */
    font-size: var(--font-size-xxs);      /* 12px */
    background: var(--color-gray-100);
    border-radius: 4px;
    color: var(--color-gray-700);
}

/* カード本文（抜粋） */
.grant-card__excerpt {
    font-size: var(--font-size-small);    /* 14px */
    line-height: 1.5;
    color: var(--color-gray-700);
    display: -webkit-box;
    -webkit-line-clamp: 3;                /* 3行まで */
    -webkit-box-orient: vertical;
    overflow: hidden;
    margin-top: auto;                     /* 下部に配置 */
}

/* カードCTA */
.grant-card__cta {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    font-size: var(--font-size-xs);       /* 13px */
    color: var(--color-primary);
    text-decoration: none;
    font-weight: 600;
    margin-top: var(--space-2);
}

.grant-card__cta:hover {
    text-decoration: underline;
}

/* ===================================
   ローディング・エラー表示
   =================================== */
.grants-loading {
    text-align: center;
    padding: var(--space-10);
    font-size: var(--font-size-small);
    color: var(--color-gray-600);
}

.grants-no-results {
    text-align: center;
    padding: var(--space-10);
}

.grants-no-results__icon {
    font-size: 48px;
    margin-bottom: var(--space-4);
}

.grants-no-results__text {
    font-size: var(--font-size-base);
    color: var(--color-gray-600);
}

/* ===================================
   レスポンシブ対応
   =================================== */
@media (max-width: 768px) {
    .grants-filters {
        flex-direction: column;
        gap: var(--space-2);              /* 8px */
    }
    
    .grants-grid {
        grid-template-columns: 1fr;       /* 1列表示 */
        gap: var(--space-3);              /* 12px */
    }
    
    .grant-card {
        padding: var(--space-2);          /* 8px */
    }
}
```

##### JavaScript外部ファイル化: `/assets/js/archive-filters.js`

```javascript
/**
 * 助成金アーカイブページ フィルター機能
 * 
 * 使用ページ: archive-grant.php, taxonomy-grant_*.php
 * 機能:
 * - カテゴリー・都道府県・市区町村フィルター
 * - AJAX検索
 * - URLパラメータ同期
 */

(function() {
    'use strict';
    
    const GrantsFilter = {
        // DOM要素
        elements: {
            categorySelect: null,
            prefectureSelect: null,
            municipalitySelect: null,
            searchInput: null,
            resetButton: null,
            resultsContainer: null,
            loadingOverlay: null,
            noResultsMessage: null
        },
        
        // 現在のフィルター状態
        state: {
            category: '',
            prefecture: '',
            municipality: '',
            search: '',
            page: 1
        },
        
        /**
         * 初期化
         */
        init: function() {
            this.cacheElements();
            this.bindEvents();
            this.loadStateFromURL();
            this.applyFilters();
        },
        
        /**
         * DOM要素のキャッシュ
         */
        cacheElements: function() {
            this.elements.categorySelect = document.getElementById('filter-category');
            this.elements.prefectureSelect = document.getElementById('filter-prefecture');
            this.elements.municipalitySelect = document.getElementById('filter-municipality');
            this.elements.searchInput = document.getElementById('filter-search');
            this.elements.resetButton = document.getElementById('filter-reset');
            this.elements.resultsContainer = document.getElementById('grants-results');
            this.elements.loadingOverlay = document.getElementById('grants-loading');
            this.elements.noResultsMessage = document.getElementById('grants-no-results');
        },
        
        /**
         * イベントバインディング
         */
        bindEvents: function() {
            const self = this;
            
            // フィルター変更イベント
            if (this.elements.categorySelect) {
                this.elements.categorySelect.addEventListener('change', function() {
                    self.state.category = this.value;
                    self.state.page = 1;
                    self.applyFilters();
                });
            }
            
            if (this.elements.prefectureSelect) {
                this.elements.prefectureSelect.addEventListener('change', function() {
                    self.state.prefecture = this.value;
                    self.state.municipality = ''; // 都道府県変更時に市区町村をリセット
                    self.state.page = 1;
                    self.loadMunicipalities();
                    self.applyFilters();
                });
            }
            
            if (this.elements.municipalitySelect) {
                this.elements.municipalitySelect.addEventListener('change', function() {
                    self.state.municipality = this.value;
                    self.state.page = 1;
                    self.applyFilters();
                });
            }
            
            // 検索入力（デバウンス処理）
            if (this.elements.searchInput) {
                let searchTimeout;
                this.elements.searchInput.addEventListener('input', function() {
                    clearTimeout(searchTimeout);
                    searchTimeout = setTimeout(function() {
                        self.state.search = self.elements.searchInput.value;
                        self.state.page = 1;
                        self.applyFilters();
                    }, 500); // 500ms後に実行
                });
            }
            
            // リセットボタン
            if (this.elements.resetButton) {
                this.elements.resetButton.addEventListener('click', function(e) {
                    e.preventDefault();
                    self.resetFilters();
                });
            }
        },
        
        /**
         * URLパラメータから状態を読み込み
         */
        loadStateFromURL: function() {
            const params = new URLSearchParams(window.location.search);
            this.state.category = params.get('category') || '';
            this.state.prefecture = params.get('prefecture') || '';
            this.state.municipality = params.get('municipality') || '';
            this.state.search = params.get('s') || '';
            this.state.page = parseInt(params.get('page')) || 1;
            
            // フォームに反映
            if (this.elements.categorySelect) this.elements.categorySelect.value = this.state.category;
            if (this.elements.prefectureSelect) this.elements.prefectureSelect.value = this.state.prefecture;
            if (this.elements.municipalitySelect) this.elements.municipalitySelect.value = this.state.municipality;
            if (this.elements.searchInput) this.elements.searchInput.value = this.state.search;
        },
        
        /**
         * フィルター適用（AJAX検索）
         */
        applyFilters: function() {
            const self = this;
            
            // ローディング表示
            this.showLoading();
            
            // URLパラメータ更新
            this.updateURL();
            
            // AJAX リクエスト
            const formData = new FormData();
            formData.append('action', 'filter_grants');
            formData.append('category', this.state.category);
            formData.append('prefecture', this.state.prefecture);
            formData.append('municipality', this.state.municipality);
            formData.append('search', this.state.search);
            formData.append('page', this.state.page);
            
            fetch(ajaxurl, {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                self.hideLoading();
                
                if (data.success) {
                    self.elements.resultsContainer.innerHTML = data.data.html;
                    
                    if (data.data.found === 0) {
                        self.elements.noResultsMessage.classList.remove('filter-hidden');
                    } else {
                        self.elements.noResultsMessage.classList.add('filter-hidden');
                    }
                } else {
                    console.error('フィルターエラー:', data);
                }
            })
            .catch(error => {
                self.hideLoading();
                console.error('AJAX エラー:', error);
            });
        },
        
        /**
         * 市区町村一覧を読み込み
         */
        loadMunicipalities: function() {
            const self = this;
            
            if (!this.state.prefecture) {
                this.elements.municipalitySelect.innerHTML = '<option value="">市区町村を選択</option>';
                this.elements.municipalitySelect.disabled = true;
                return;
            }
            
            const formData = new FormData();
            formData.append('action', 'get_municipalities');
            formData.append('prefecture', this.state.prefecture);
            
            fetch(ajaxurl, {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    let options = '<option value="">市区町村を選択</option>';
                    data.data.forEach(function(municipality) {
                        options += `<option value="${municipality.slug}">${municipality.name}</option>`;
                    });
                    self.elements.municipalitySelect.innerHTML = options;
                    self.elements.municipalitySelect.disabled = false;
                }
            })
            .catch(error => {
                console.error('市区町村読み込みエラー:', error);
            });
        },
        
        /**
         * フィルターリセット
         */
        resetFilters: function() {
            this.state = {
                category: '',
                prefecture: '',
                municipality: '',
                search: '',
                page: 1
            };
            
            if (this.elements.categorySelect) this.elements.categorySelect.value = '';
            if (this.elements.prefectureSelect) this.elements.prefectureSelect.value = '';
            if (this.elements.municipalitySelect) {
                this.elements.municipalitySelect.value = '';
                this.elements.municipalitySelect.disabled = true;
            }
            if (this.elements.searchInput) this.elements.searchInput.value = '';
            
            this.applyFilters();
        },
        
        /**
         * URLパラメータ更新
         */
        updateURL: function() {
            const params = new URLSearchParams();
            
            if (this.state.category) params.set('category', this.state.category);
            if (this.state.prefecture) params.set('prefecture', this.state.prefecture);
            if (this.state.municipality) params.set('municipality', this.state.municipality);
            if (this.state.search) params.set('s', this.state.search);
            if (this.state.page > 1) params.set('page', this.state.page);
            
            const newURL = window.location.pathname + (params.toString() ? '?' + params.toString() : '');
            window.history.pushState({}, '', newURL);
        },
        
        /**
         * ローディング表示
         */
        showLoading: function() {
            if (this.elements.loadingOverlay) {
                this.elements.loadingOverlay.classList.remove('filter-hidden');
            }
        },
        
        /**
         * ローディング非表示
         */
        hideLoading: function() {
            if (this.elements.loadingOverlay) {
                this.elements.loadingOverlay.classList.add('filter-hidden');
            }
        }
    };
    
    // DOM読み込み完了後に初期化
    document.addEventListener('DOMContentLoaded', function() {
        GrantsFilter.init();
    });
    
})();
```

##### PHP修正: `archive-grant.php`

```php
<?php
/**
 * Template Name: 助成金アーカイブ
 * 
 * スタイル: /assets/css/archive-grants.css
 * スクリプト: /assets/js/archive-filters.js
 */

get_header();
?>

<!-- 外部CSS読み込み -->
<link rel="stylesheet" href="<?php echo get_template_directory_uri(); ?>/assets/css/archive-grants.css">

<div class="grants-archive-page">
    
    <!-- フィルターセクション -->
    <section class="grants-filters">
        <select id="filter-category" class="filter-select" aria-label="カテゴリー選択">
            <option value="">カテゴリーを選択</option>
            <?php
            $categories = get_terms(['taxonomy' => 'grant_category', 'hide_empty' => false]);
            foreach ($categories as $cat) {
                echo '<option value="' . esc_attr($cat->slug) . '">' . esc_html($cat->name) . '</option>';
            }
            ?>
        </select>
        
        <select id="filter-prefecture" class="filter-select" aria-label="都道府県選択">
            <option value="">都道府県を選択</option>
            <?php
            $prefectures = get_terms(['taxonomy' => 'grant_prefecture', 'hide_empty' => false]);
            foreach ($prefectures as $pref) {
                echo '<option value="' . esc_attr($pref->slug) . '">' . esc_html($pref->name) . '</option>';
            }
            ?>
        </select>
        
        <select id="filter-municipality" class="filter-select" aria-label="市区町村選択" disabled>
            <option value="">市区町村を選択</option>
        </select>
        
        <input 
            type="search" 
            id="filter-search" 
            class="filter-select" 
            placeholder="キーワード検索..." 
            aria-label="検索"
        >
        
        <button id="filter-reset" class="filter-reset-btn">
            リセット
        </button>
    </section>
    
    <!-- ローディング表示 -->
    <div id="grants-loading" class="grants-loading filter-hidden">
        <span class="loading-spinner"></span>
        検索中...
    </div>
    
    <!-- 結果表示エリア -->
    <div id="grants-results">
        <div class="grants-grid">
            <?php
            $query = new WP_Query([
                'post_type' => 'grant',
                'posts_per_page' => 24,  // 6x4グリッド想定
                'paged' => get_query_var('paged', 1)
            ]);
            
            if ($query->have_posts()) :
                while ($query->have_posts()) : $query->the_post();
                    get_template_part('template-parts/grant-card', 'compact');
                endwhile;
            endif;
            
            wp_reset_postdata();
            ?>
        </div>
        
        <!-- ページネーション -->
        <div class="grants-pagination">
            <?php
            echo paginate_links([
                'total' => $query->max_num_pages,
                'prev_text' => '&laquo; 前へ',
                'next_text' => '次へ &raquo;'
            ]);
            ?>
        </div>
    </div>
    
    <!-- 検索結果なし -->
    <div id="grants-no-results" class="grants-no-results filter-hidden">
        <div class="grants-no-results__icon">🔍</div>
        <p class="grants-no-results__text">
            条件に一致する助成金が見つかりませんでした。<br>
            フィルターを変更してお試しください。
        </p>
    </div>
    
</div>

<!-- 外部JavaScript読み込み -->
<script src="<?php echo get_template_directory_uri(); ?>/assets/js/archive-filters.js" defer></script>

<?php get_footer(); ?>
```

##### カードテンプレート: `template-parts/grant-card-compact.php`

```php
<?php
/**
 * 助成金カード（コンパクト版）
 * 
 * 縮小感のある高密度表示用
 */
?>

<article class="grant-card">
    <h3 class="grant-card__title">
        <a href="<?php the_permalink(); ?>">
            <?php the_title(); ?>
        </a>
    </h3>
    
    <div class="grant-card__meta">
        <?php
        // カテゴリー
        $categories = get_the_terms(get_the_ID(), 'grant_category');
        if ($categories && !is_wp_error($categories)) {
            echo '<span class="grant-card__meta-item">';
            echo '<span class="icon">📁</span>';
            echo esc_html($categories[0]->name);
            echo '</span>';
        }
        
        // 都道府県
        $prefectures = get_the_terms(get_the_ID(), 'grant_prefecture');
        if ($prefectures && !is_wp_error($prefectures)) {
            echo '<span class="grant-card__meta-item">';
            echo '<span class="icon">📍</span>';
            echo esc_html($prefectures[0]->name);
            echo '</span>';
        }
        
        // 締切日
        $deadline = get_post_meta(get_the_ID(), 'deadline_date', true);
        if ($deadline) {
            echo '<span class="grant-card__meta-item">';
            echo '<span class="icon">⏰</span>';
            echo esc_html(date('Y/m/d', strtotime($deadline)));
            echo '</span>';
        }
        ?>
    </div>
    
    <?php
    // タグ表示
    $tags = get_the_terms(get_the_ID(), 'grant_tag');
    if ($tags && !is_wp_error($tags)) :
    ?>
    <div class="grant-card__tags">
        <?php foreach ($tags as $tag) : ?>
            <span class="grant-card__tag"><?php echo esc_html($tag->name); ?></span>
        <?php endforeach; ?>
    </div>
    <?php endif; ?>
    
    <div class="grant-card__excerpt">
        <?php echo wp_trim_words(get_the_excerpt(), 50, '...'); ?>
    </div>
    
    <a href="<?php the_permalink(); ?>" class="grant-card__cta">
        詳細を見る <span class="arrow">→</span>
    </a>
</article>
```

### 3. 診断ページ（page-subsidy-diagnosis.php）

**すでに分析済み（重要度S項目参照）**

改善内容:
- 597行のインラインCSS → `/assets/css/diagnosis-page.css`
- 120行のインラインJS → `/assets/js/diagnosis-page.js`

### 4. 都道府県ページ（taxonomy-grant_prefecture.php）

#### WebFetch分析結果（https://joseikin-insight.com/prefecture/hokkaido/）

**現状**:
- 北海道の助成金一覧表示
- 地域情報セクション
- 市区町村リンク
- 構造化データ充実（CollectionPage, GovernmentService, FAQPage）

**SEO評価**: ✅ 優秀
```php
// lines 86-95: 完全なSEOメタタグ
<meta name="geo.region" content="JP">
<meta name="geo.placename" content="<?php echo esc_attr($prefecture_name); ?>">
```

#### 改善提案（縮小感重視）

```css
/* 都道府県ページ専用スタイル */
.prefecture-page {
    max-width: var(--container-max-width);
    margin: 0 auto;
    padding: var(--space-4);              /* 16px */
}

/* ページヘッダー（コンパクト化） */
.prefecture-header {
    padding: var(--space-6) 0;            /* 24px 0（通常より小さめ） */
    border-bottom: 1px solid var(--color-gray-200);
    margin-bottom: var(--space-6);
}

.prefecture-header__title {
    font-size: var(--font-size-h1);       /* 28-36px */
    line-height: 1.2;
    margin-bottom: var(--space-2);        /* 8px */
}

.prefecture-header__description {
    font-size: var(--font-size-base);     /* 16px */
    line-height: 1.5;
    color: var(--color-gray-600);
}

/* 市区町村リンク（横スクロール対応） */
.prefecture-municipalities {
    margin-bottom: var(--space-6);
}

.prefecture-municipalities__title {
    font-size: var(--font-size-h3);       /* 18-22px */
    margin-bottom: var(--space-3);        /* 12px */
}

.prefecture-municipalities__list {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-2);                  /* 8px */
    list-style: none;
    padding: 0;
    margin: 0;
}

.prefecture-municipalities__item {
    flex-shrink: 0;
}

.prefecture-municipalities__link {
    display: inline-block;
    padding: var(--space-1) var(--space-3); /* 4px 12px */
    font-size: var(--font-size-small);    /* 14px */
    background: var(--color-gray-100);
    border-radius: 6px;
    text-decoration: none;
    color: var(--color-gray-800);
    transition: all 0.2s ease;
}

.prefecture-municipalities__link:hover {
    background: var(--color-gray-200);
    color: var(--color-black);
}

/* 助成金リスト（archive-grants.cssを再利用） */
.prefecture-grants {
    /* archive-grants.cssの.grants-gridスタイルを継承 */
}
```

### 5. 個別助成金ページ（single-grant.php）

#### 現状分析（既存）

**Critical Issue**:
```css
/* Line 435 */
--gus-text-base: 0.875rem;   /* 14px ← 16pxに変更必須 */
```

#### 修正内容

```css
/* single-grant.php line 435付近 */
:root {
    /* タイポグラフィ変数 */
    --gus-text-base: 1rem;               /* 16px（変更） */
    --gus-text-small: 0.875rem;          /* 14px */
    --gus-text-xs: 0.8125rem;            /* 13px */
    
    /* 行間（縮小感重視） */
    --gus-line-height-base: 1.5;         /* 通常1.6 → 1.5に */
    --gus-line-height-heading: 1.3;      /* 見出し用 */
    
    /* 見出しサイズ（縮小感重視） */
    --gus-h1-size: clamp(24px, 4vw, 32px); /* ページタイトル */
    --gus-h2-size: clamp(20px, 3vw, 24px); /* セクション見出し */
    --gus-h3-size: 18px;                   /* サブセクション */
    
    /* 余白（詰める） */
    --gus-section-gap: var(--space-6);   /* 24px */
    --gus-element-gap: var(--space-3);   /* 12px */
}

/* 本文スタイル */
.grant-single-content {
    font-size: var(--gus-text-base);      /* 16px */
    line-height: var(--gus-line-height-base); /* 1.5 */
    color: var(--color-gray-800);
}

/* 情報テーブル（コンパクト化） */
.grant-info-table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: var(--gus-section-gap);
}

.grant-info-table th,
.grant-info-table td {
    padding: var(--space-2) var(--space-3); /* 8px 12px */
    border: 1px solid var(--color-gray-200);
    font-size: var(--gus-text-base);      /* 16px */
}

.grant-info-table th {
    background: var(--color-gray-50);
    font-weight: 600;
    width: 30%;                           /* 項目名は30% */
    text-align: left;
}
```

---

## 統一デザインシステム

### 🎨 統一カラーパレット

**現状**: 4つの異なるカラーシステムが存在

#### 推奨統一パレット（style.cssに集約）

```css
:root {
    /* ===================================
       統一カラーシステム
       全ファイルで共通使用
       =================================== */
    
    /* プライマリカラー（緑系 - 現行の--color-primaryを継承） */
    --color-primary: #059669;            /* Emerald 600 */
    --color-primary-light: #10b981;      /* Emerald 500 */
    --color-primary-dark: #047857;       /* Emerald 700 */
    
    /* セカンダリカラー（黒系 - header.phpから継承） */
    --color-secondary: #000000;
    --color-secondary-light: #1a1a1a;
    --color-secondary-dark: #000000;
    
    /* アクセントカラー（黄色 - section-hero.phpから継承） */
    --color-accent: #ffeb3b;             /* Yellow */
    --color-accent-light: #fff9c4;       /* Yellow 100 */
    --color-accent-dark: #fbc02d;        /* Yellow 700 */
    
    /* グレースケール（統一版） */
    --color-white: #ffffff;
    --color-black: #000000;
    --color-gray-50: #f9fafb;
    --color-gray-100: #f3f4f6;
    --color-gray-200: #e5e7eb;
    --color-gray-300: #d1d5db;
    --color-gray-400: #6b7280;           /* 修正: #9ca3af → #6b7280（コントラスト比改善） */
    --color-gray-500: #6b7280;
    --color-gray-600: #4b5563;
    --color-gray-700: #374151;
    --color-gray-800: #1f2937;
    --color-gray-900: #111827;
    
    /* 状態カラー */
    --color-success: #10b981;            /* Green */
    --color-warning: #f59e0b;            /* Amber */
    --color-error: #ef4444;              /* Red */
    --color-info: #3b82f6;               /* Blue */
    
    /* 背景カラー */
    --color-bg-primary: var(--color-white);
    --color-bg-secondary: var(--color-gray-50);
    --color-bg-tertiary: var(--color-gray-100);
    
    /* テキストカラー */
    --color-text-primary: var(--color-gray-900);
    --color-text-secondary: var(--color-gray-700);
    --color-text-tertiary: var(--color-gray-600);
    --color-text-muted: var(--color-gray-500);
    
    /* ボーダーカラー */
    --color-border-light: var(--color-gray-200);
    --color-border-medium: var(--color-gray-300);
    --color-border-dark: var(--color-gray-400);
}
```

#### 既存ファイルの修正箇所

**header.php**: 39-65行目
```css
/* 削除または統一カラーに置き換え */
/* 現状の独自カラー変数を削除し、上記の統一変数を使用 */
```

**section-hero.php**: カラー定義部分
```css
/* Yellow accentはそのまま（統一パレットに含まれる） */
--hero-accent: var(--color-accent);   /* #ffeb3b */
```

**single-grant.php**: 418-430行目
```css
/* 独自グレー変数を削除し、統一変数を使用 */
.grant-single {
    color: var(--color-text-primary);    /* 統一変数に */
    background: var(--color-bg-primary);
}
```

### 🔲 統一ボタンシステム

**現状**: 4つの異なるボタンスタイル

#### 推奨統一ボタンコンポーネント

**新規作成: `/assets/css/components/buttons.css`**

```css
/**
 * 統一ボタンコンポーネント
 * 
 * 全ページで共通使用
 * 縮小感重視のコンパクトデザイン
 */

/* ===================================
   ベースボタンスタイル
   =================================== */
.btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-1);                 /* 4px */
    padding: var(--space-2) var(--space-4); /* 8px 16px（コンパクト） */
    font-size: var(--font-size-button);  /* 15px */
    font-weight: 600;
    line-height: 1.4;
    text-align: center;
    text-decoration: none;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s ease;
    white-space: nowrap;
    min-height: 40px;                    /* タッチターゲット確保 */
}

.btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

/* ===================================
   サイズバリエーション
   =================================== */
.btn--small {
    padding: var(--space-1) var(--space-3); /* 4px 12px */
    font-size: var(--font-size-small);   /* 14px */
    min-height: 32px;
}

.btn--large {
    padding: var(--space-3) var(--space-6); /* 12px 24px */
    font-size: var(--font-size-base);    /* 16px */
    min-height: 48px;
}

.btn--full {
    width: 100%;
}

/* ===================================
   カラーバリエーション
   =================================== */

/* プライマリ（緑） */
.btn--primary {
    background: var(--color-primary);
    color: var(--color-white);
    border: 2px solid var(--color-primary);
}

.btn--primary:hover {
    background: var(--color-primary-dark);
    border-color: var(--color-primary-dark);
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(5, 150, 105, 0.3);
}

.btn--primary:active {
    transform: translateY(0);
}

/* セカンダリ（黒） */
.btn--secondary {
    background: var(--color-secondary);
    color: var(--color-white);
    border: 2px solid var(--color-secondary);
}

.btn--secondary:hover {
    background: var(--color-secondary-light);
    border-color: var(--color-secondary-light);
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
}

/* アクセント（黄色） */
.btn--accent {
    background: var(--color-accent);
    color: var(--color-secondary);
    border: 2px solid var(--color-accent);
    font-weight: 700;
}

.btn--accent:hover {
    background: var(--color-accent-dark);
    border-color: var(--color-accent-dark);
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(255, 235, 59, 0.5);
}

/* アウトライン（枠線のみ） */
.btn--outline {
    background: transparent;
    color: var(--color-primary);
    border: 2px solid var(--color-primary);
}

.btn--outline:hover {
    background: var(--color-primary);
    color: var(--color-white);
}

/* ゴースト（背景なし） */
.btn--ghost {
    background: transparent;
    color: var(--color-primary);
    border: 2px solid transparent;
}

.btn--ghost:hover {
    background: var(--color-gray-100);
    border-color: var(--color-gray-200);
}

/* テキストのみ */
.btn--text {
    background: transparent;
    color: var(--color-primary);
    border: none;
    padding: 0;
    min-height: auto;
    text-decoration: underline;
    text-underline-offset: 2px;
}

.btn--text:hover {
    color: var(--color-primary-dark);
    text-decoration: none;
}

/* ===================================
   アイコン付きボタン
   =================================== */
.btn__icon {
    display: inline-flex;
    font-size: 1.2em;
}

.btn__icon--left {
    margin-right: var(--space-1);
}

.btn__icon--right {
    margin-left: var(--space-1);
}

/* ===================================
   ボタングループ
   =================================== */
.btn-group {
    display: flex;
    gap: var(--space-2);                 /* 8px */
    flex-wrap: wrap;
}

.btn-group--vertical {
    flex-direction: column;
}

.btn-group .btn {
    flex: 1;
}

/* ===================================
   レスポンシブ対応
   =================================== */
@media (max-width: 768px) {
    .btn {
        padding: var(--space-2) var(--space-3); /* さらにコンパクト */
    }
    
    .btn-group {
        flex-direction: column;
    }
    
    .btn-group .btn {
        width: 100%;
    }
}
```

#### 使用例

```html
<!-- プライマリボタン（標準） -->
<a href="/grants/" class="btn btn--primary">
    助成金を検索
</a>

<!-- セカンダリボタン（小サイズ） -->
<button class="btn btn--secondary btn--small">
    詳細を見る
</button>

<!-- アクセントボタン（大サイズ） -->
<a href="/subsidy-diagnosis/" class="btn btn--accent btn--large">
    <span class="btn__icon btn__icon--left">🎯</span>
    今すぐ診断を開始
</a>

<!-- アウトラインボタン -->
<button class="btn btn--outline">
    キャンセル
</button>

<!-- ボタングループ -->
<div class="btn-group">
    <button class="btn btn--primary">保存</button>
    <button class="btn btn--outline">キャンセル</button>
</div>
```

### 📦 統一カードコンポーネント

**新規作成: `/assets/css/components/cards.css`**

```css
/**
 * 統一カードコンポーネント
 * 
 * 縮小感重視の高密度レイアウト
 */

/* ===================================
   ベースカードスタイル
   =================================== */
.card {
    background: var(--color-white);
    border: 1px solid var(--color-border-light);
    border-radius: 8px;                  /* コンパクト */
    padding: var(--space-3);             /* 12px */
    transition: all 0.2s ease;
}

.card:hover {
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    transform: translateY(-2px);
}

/* カード内要素の間隔 */
.card > * + * {
    margin-top: var(--space-2);          /* 8px */
}

/* ===================================
   カードヘッダー
   =================================== */
.card__header {
    padding-bottom: var(--space-2);
    border-bottom: 1px solid var(--color-border-light);
}

.card__title {
    font-size: var(--font-size-h4);      /* 18px */
    line-height: var(--line-height-heading); /* 1.3 */
    font-weight: 600;
    margin: 0;
}

.card__subtitle {
    font-size: var(--font-size-small);   /* 14px */
    color: var(--color-text-tertiary);
    margin-top: var(--space-1);          /* 4px */
}

/* ===================================
   カード本文
   =================================== */
.card__body {
    font-size: var(--font-size-base);    /* 16px */
    line-height: var(--line-height-base); /* 1.5 */
    color: var(--color-text-secondary);
}

/* ===================================
   カードフッター
   =================================== */
.card__footer {
    padding-top: var(--space-2);
    border-top: 1px solid var(--color-border-light);
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: var(--space-2);
}

/* ===================================
   カードメタ情報
   =================================== */
.card__meta {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-2);                 /* 8px */
    font-size: var(--font-size-xs);      /* 13px */
    color: var(--color-text-muted);
}

.card__meta-item {
    display: flex;
    align-items: center;
    gap: 4px;
}

/* ===================================
   カードタグ
   =================================== */
.card__tags {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-1);                 /* 4px */
}

.card__tag {
    padding: 2px 6px;
    font-size: var(--font-size-xxs);     /* 12px */
    background: var(--color-bg-tertiary);
    border-radius: 4px;
    color: var(--color-text-secondary);
}

/* ===================================
   カードバリエーション
   =================================== */

/* コンパクトカード（最小サイズ） */
.card--compact {
    padding: var(--space-2);             /* 8px */
}

.card--compact .card__title {
    font-size: 16px;
}

/* ホリゾンタルカード */
.card--horizontal {
    display: flex;
    gap: var(--space-3);
}

.card--horizontal .card__image {
    flex-shrink: 0;
    width: 120px;
    height: 120px;
    object-fit: cover;
    border-radius: 6px;
}

/* ハイライトカード */
.card--highlight {
    border-color: var(--color-primary);
    border-width: 2px;
}

/* インタラクティブカード */
.card--interactive {
    cursor: pointer;
}

.card--interactive:hover {
    border-color: var(--color-primary);
    box-shadow: 0 6px 20px rgba(5, 150, 105, 0.15);
}
```

---

## 実装ガイド

### 🚀 実装ステップ

#### Phase 1: CSS/JS外部ファイル化（最優先）

**作業時間**: 約2時間

1. **ディレクトリ作成**
```bash
cd /home/user/webapp && mkdir -p assets/css assets/js assets/css/components assets/js/utils
```

2. **page-subsidy-diagnosis.php リファクタリング**
   - `assets/css/diagnosis-page.css` 作成（597行のCSSを移植）
   - `assets/js/diagnosis-page.js` 作成（120行のJSを移植）
   - `page-subsidy-diagnosis.php` 修正（インライン削除、外部ファイル読み込み）

3. **archive-grant.php リファクタリング**
   - `assets/css/archive-grants.css` 作成
   - `assets/js/archive-filters.js` 作成
   - `archive-grant.php` 修正

4. **動作確認**
   - 各ページの表示確認
   - JavaScriptの動作確認（フィルター、iframe）
   - ブラウザキャッシュの確認

#### Phase 2: 統一デザインシステム構築

**作業時間**: 約1.5時間

1. **style.css に統一変数追加**
   - カラーパレット統一
   - スペーシング変数追加
   - タイポグラフィ変数追加

2. **コンポーネントファイル作成**
   - `assets/css/components/buttons.css`
   - `assets/css/components/cards.css`
   - `assets/css/components/forms.css`（必要に応じて）

3. **既存ファイルの変数置き換え**
   - header.php
   - section-hero.php
   - single-grant.php

#### Phase 3: 細部修正

**作業時間**: 約30分

1. **h1タグ重複修正**（header.php 259-265行目）
2. **フォントサイズ修正**（single-grant.php 435行目）
3. **コントラスト比修正**（style.css 24行目）

#### Phase 4: テストと検証

**作業時間**: 約1時間

1. **表示確認**（全ページ）
2. **レスポンシブ確認**（モバイル、タブレット、デスクトップ）
3. **SEO確認**（h1タグ、構造化データ）
4. **パフォーマンス確認**（PageSpeed Insights）
5. **アクセシビリティ確認**（コントラスト、タッチターゲット）

### 📝 Git Commit メッセージ例

```bash
# Phase 1
git commit -m "refactor(css): 診断ページのインラインCSS (597行) を外部ファイル化"
git commit -m "refactor(js): 診断ページのインラインJS (120行) を外部ファイル化"
git commit -m "refactor(css): アーカイブページのCSSとJSを外部ファイル化"

# Phase 2
git commit -m "feat(design-system): 統一カラーパレットをstyle.cssに追加"
git commit -m "feat(components): 統一ボタンコンポーネントを追加"
git commit -m "feat(components): 統一カードコンポーネントを追加"

# Phase 3
git commit -m "fix(seo): header.phpのh1タグ重複を修正（トップページのみh1）"
git commit -m "fix(typography): single-grant.phpの基本フォントサイズを14px→16pxに修正"
git commit -m "fix(a11y): --color-gray-400のコントラスト比をWCAG AAに準拠"

# Phase 4
git commit -m "test: 全ページの表示とレスポンシブ対応を確認"
```

### 🔧 functions.php への追加（スクリプト管理）

**新規作成: `/inc/enqueue-scripts.php`**

```php
<?php
/**
 * CSS/JavaScriptの読み込み管理
 * 
 * 外部ファイル化したスクリプトを適切なページで読み込む
 */

function gi_enqueue_page_specific_assets() {
    // テーマディレクトリURI
    $theme_uri = get_template_directory_uri();
    
    // 診断ページ
    if (is_page_template('page-subsidy-diagnosis.php')) {
        wp_enqueue_style(
            'diagnosis-page',
            $theme_uri . '/assets/css/diagnosis-page.css',
            array(),
            '1.0.0'
        );
        
        wp_enqueue_script(
            'diagnosis-page',
            $theme_uri . '/assets/js/diagnosis-page.js',
            array(),
            '1.0.0',
            true
        );
    }
    
    // アーカイブページ
    if (is_post_type_archive('grant') || is_tax('grant_prefecture') || is_tax('grant_category')) {
        wp_enqueue_style(
            'archive-grants',
            $theme_uri . '/assets/css/archive-grants.css',
            array(),
            '1.0.0'
        );
        
        wp_enqueue_script(
            'archive-filters',
            $theme_uri . '/assets/js/archive-filters.js',
            array(),
            '1.0.0',
            true
        );
        
        // AJAX用のURLをJavaScriptに渡す
        wp_localize_script('archive-filters', 'ajaxurl', admin_url('admin-ajax.php'));
    }
    
    // 統一コンポーネント（全ページで読み込み）
    wp_enqueue_style(
        'components-buttons',
        $theme_uri . '/assets/css/components/buttons.css',
        array(),
        '1.0.0'
    );
    
    wp_enqueue_style(
        'components-cards',
        $theme_uri . '/assets/css/components/cards.css',
        array(),
        '1.0.0'
    );
}
add_action('wp_enqueue_scripts', 'gi_enqueue_page_specific_assets');
```

**functions.php に追加**:

```php
// CSS/JavaScript管理
require_once get_template_directory() . '/inc/enqueue-scripts.php';
```

---

## 作業優先順位

### 🔴 優先度S（即時対応必須）

| # | タスク | ファイル | 時間 | 理由 |
|---|--------|----------|------|------|
| 1 | **診断ページCSS外部ファイル化** | page-subsidy-diagnosis.php | 60分 | メンテナンス性Critical |
| 2 | **診断ページJS外部ファイル化** | page-subsidy-diagnosis.php | 30分 | メンテナンス性Critical |

### 🟠 優先度A（重要）

| # | タスク | ファイル | 時間 | 理由 |
|---|--------|----------|------|------|
| 3 | **h1タグ重複修正** | header.php | 15分 | SEO影響大 |
| 4 | **フォントサイズ16px化** | single-grant.php | 10分 | 可読性Critical |
| 5 | **アーカイブCSS/JS外部化** | archive-grant.php | 90分 | メンテナンス性重要 |

### 🟡 優先度B（推奨）

| # | タスク | ファイル | 時間 | 理由 |
|---|--------|----------|------|------|
| 6 | **統一カラーパレット** | style.css | 30分 | デザイン一貫性 |
| 7 | **統一ボタンコンポーネント** | components/buttons.css | 45分 | UI一貫性 |
| 8 | **統一カードコンポーネント** | components/cards.css | 30分 | UI一貫性 |
| 9 | **コントラスト比修正** | style.css | 5分 | アクセシビリティ |

### 🟢 優先度C（時間があれば）

| # | タスク | ファイル | 時間 | 理由 |
|---|--------|----------|------|------|
| 10 | **都道府県ページCSS作成** | taxonomy-grant_prefecture.php | 30分 | 最適化 |
| 11 | **全体のレスポンシブ見直し** | 全ファイル | 60分 | UX向上 |

### 📊 合計作業時間見積もり

- **優先度S**: 90分
- **優先度A**: 115分
- **優先度B**: 110分
- **優先度C**: 90分
- **合計**: **約6.5時間**

---

## まとめ

### ✅ 実施内容

1. **CSS/JS管理の抜本的改善**
   - page-subsidy-diagnosis.php: 681行のインラインCSS/JSを外部ファイル化
   - archive-grant.php: フィルター機能のCSS/JSを外部ファイル化
   - 責任分離によるメンテナンス性向上

2. **縮小感のある見やすいデザイン仕様策定**
   - 基本フォントサイズ: 16px（可読性確保）
   - 見出しサイズ: 28-36px（h1）、22-28px（h2）、18-22px（h3）
   - 行間: 1.5（情報密度重視）
   - 余白: 8pxグリッドシステム
   - カードpadding: 12px（コンパクト化）

3. **ページ別詳細分析**
   - トップページ: Hero縮小、17px→16px統一
   - アーカイブページ: 4列グリッド、高密度カードレイアウト
   - 診断ページ: CSS/JS外部ファイル化
   - 都道府県ページ: コンパクトヘッダー、市区町村リスト最適化
   - 個別ページ: 14px→16px修正

4. **統一デザインシステム構築**
   - 統一カラーパレット（4つのシステムを1つに）
   - 統一ボタンコンポーネント（4つのスタイルを1つに）
   - 統一カードコンポーネント
   - スペーシングシステム（--space-1 ～ --space-12）

5. **実装ガイド**
   - Phase 1-4の詳細手順
   - Git commitメッセージ例
   - functions.phpへのスクリプト管理追加
   - 作業時間見積もり（合計6.5時間）

### 🎯 期待される効果

#### メンテナンス性
- ✅ CSS変更時にPHPファイルを編集不要
- ✅ 検索性向上（どこに何があるか明確）
- ✅ 複数人開発が容易
- ✅ Gitでの差分確認が明確
- ✅ ブラウザキャッシュが効く（パフォーマンス向上）

#### デザイン一貫性
- ✅ 統一されたカラーパレット
- ✅ 統一されたボタンスタイル
- ✅ 統一されたカードレイアウト
- ✅ 一貫したスペーシング

#### SEO/アクセシビリティ
- ✅ h1タグ重複解消（SEO改善）
- ✅ コントラスト比WCAG AA準拠
- ✅ 適切なフォントサイズ（16px）
- ✅ タッチターゲット44px以上確保

#### ユーザー体験
- ✅ 情報密度の高い見やすいレイアウト
- ✅ 縮小感がありつつ可読性を維持
- ✅ コンパクトで洗練されたデザイン
- ✅ レスポンシブ対応強化

### 📚 成果物

1. **このレポートファイル**: `包括的改善レポート_メンテナンス性重視.md`
2. **実装用コードサンプル**:
   - `/assets/css/diagnosis-page.css`（サンプルコード含む）
   - `/assets/js/diagnosis-page.js`（サンプルコード含む）
   - `/assets/css/archive-grants.css`（サンプルコード含む）
   - `/assets/js/archive-filters.js`（サンプルコード含む）
   - `/assets/css/components/buttons.css`（サンプルコード含む）
   - `/assets/css/components/cards.css`（サンプルコード含む）
   - `/inc/enqueue-scripts.php`（サンプルコード含む）
3. **統一デザインシステム仕様**
4. **実装ガイド**（Phase 1-4）
5. **優先順位付きタスクリスト**

---

**次のステップ**: 優先度Sのタスク（診断ページCSS/JS外部ファイル化）から着手してください。

以上