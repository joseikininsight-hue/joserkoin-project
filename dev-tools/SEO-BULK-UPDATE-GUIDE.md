# SEO バルクアップデート実行手順書

**作成日**: 2025-10-25  
**対象**: joseikin-insight テーマ v2.0.0  
**目的**: 全 grant 投稿（約4,000件）に対して SEO タイトル・説明文を一括生成

---

## ✅ Phase E: バルクアップデート実行

### 前提条件
- **Phase D（テスト）** が完了している
- WordPress 管理画面にログイン済み
- joseikin-insight テーマが有効化されている
- **データベースのバックアップを取得済み** ⚠️

---

## 🚨 実行前の重要確認事項

### 1. データベースバックアップ

**必ず実行してください！**

#### 方法 A: WordPress プラグインを使用
```bash
# UpdraftPlus または BackWPup プラグインでバックアップ
プラグイン → 新規追加 → "UpdraftPlus" で検索 → インストール → 有効化
設定 → UpdraftPlus Backups → 今すぐバックアップ
```

#### 方法 B: WP-CLI を使用（サーバーアクセス可能な場合）
```bash
cd /path/to/wordpress
wp db export backup_$(date +%Y%m%d_%H%M%S).sql
```

#### 方法 C: phpMyAdmin を使用
```
phpMyAdmin → データベース選択 → エクスポート → 実行
```

### 2. テスト環境での動作確認

本番環境で実行する前に、**ステージング環境** または **ローカル環境** でテストすることを強く推奨します。

---

## 📋 実行手順

### ステップ 1: WordPress 管理画面にアクセス

1. WordPress 管理画面にログイン
2. 左メニューから **助成金** → **SEO 一括更新** をクリック

※ メニューが表示されない場合は、テーマが正しく有効化されているか確認してください。

---

### ステップ 2: バルクアップデート画面の確認

**画面に表示される情報**:
- 現在の grant 投稿総数（例: 4,032件）
- バッチサイズ（100件/回）
- 推定処理時間（例: 約40分）

**重要な注意事項**:
- 処理中はブラウザを閉じないでください
- サーバーのタイムアウト設定を確認してください（推奨: 300秒以上）
- 処理中に他のユーザーが投稿を編集しないように注意してください

---

### ステップ 3: バルクアップデート実行

1. **「一括更新を開始」** ボタンをクリック
2. 確認ダイアログが表示されます：
   ```
   約4,000件の助成金投稿に対してSEOタイトル・説明文を自動生成します。
   この処理には約40分かかります。
   
   実行しますか？
   ```
3. **「OK」** をクリック

---

### ステップ 4: 進行状況の監視

**画面に表示される情報**:
```
処理中: 300 / 4032 件 (7%)
現在のバッチ: 3 / 41
推定残り時間: 35分

最近処理した投稿:
- ID: 12345 「東京都中小企業向けDX推進助成金」 ✅
- ID: 12346 「大阪市創業支援補助金」 ✅
- ID: 12347 「横浜市環境対策助成金」 ✅
```

**進行状況の確認ポイント**:
- [ ] 処理が順調に進んでいる
- [ ] エラーメッセージが表示されていない
- [ ] ブラウザのコンソールにエラーがない（F12 → Console タブ）

---

### ステップ 5: 完了確認

**完了メッセージ**:
```
✅ 一括更新が完了しました！

処理結果:
- 処理件数: 4,032件
- 成功: 4,025件
- スキップ: 7件（ACFデータ不足）
- エラー: 0件
- 処理時間: 38分12秒

次のステップ:
1. いくつかの投稿ページを確認して、SEOタイトル・説明文が正しく表示されているか確認してください。
2. Google Search Console でクロールエラーがないか確認してください。
```

---

## 🔍 処理後の確認作業

### 1. ランダムサンプリング確認

10〜20件の投稿をランダムに選んで確認：

```bash
# WordPress 管理画面 → 助成金 → 投稿一覧
# ランダムに10件選択して以下を確認：
```

#### 確認ポイント
- [ ] `_gi_seo_title` フィールドが生成されている
- [ ] `_gi_seo_description` フィールドが生成されている
- [ ] タイトルが40文字以内
- [ ] 説明文が120-160文字の範囲内
- [ ] 不自然な文章になっていない
- [ ] 地域名・金額・締切日が正しく反映されている

---

### 2. フロントエンド確認

ランダムに5〜10ページをブラウザで開いて確認：

#### 確認ポイント
- [ ] `<title>` タグが正しく表示されている
- [ ] Meta description が正しく表示されている
- [ ] OGP タグが正しく表示されている
- [ ] 内部リンクセクションが表示されている
- [ ] ページの読み込みが遅くなっていない

---

### 3. SEO ツールでの確認

#### Google Search Console
```
1. Google Search Console にアクセス
2. URL検査ツールで数件のページをチェック
3. 「公開URLをテスト」でクロール可能か確認
```

#### Rich Results Test
```
https://search.google.com/test/rich-results
↓
5〜10件のURLをテスト
↓
エラーがないことを確認
```

---

### 4. データベース確認（オプション）

WP-CLI または phpMyAdmin で確認：

```sql
-- SEO タイトルが生成された投稿数
SELECT COUNT(*) FROM wp_postmeta 
WHERE meta_key = '_gi_seo_title' 
AND meta_value != '';

-- SEO 説明文が生成された投稿数
SELECT COUNT(*) FROM wp_postmeta 
WHERE meta_key = '_gi_seo_description' 
AND meta_value != '';

-- 最近生成されたSEO情報の確認（上位10件）
SELECT p.ID, p.post_title, 
       m1.meta_value as seo_title,
       m2.meta_value as seo_description,
       m3.meta_value as generated_at
FROM wp_posts p
LEFT JOIN wp_postmeta m1 ON p.ID = m1.post_id AND m1.meta_key = '_gi_seo_title'
LEFT JOIN wp_postmeta m2 ON p.ID = m2.post_id AND m2.meta_key = '_gi_seo_description'
LEFT JOIN wp_postmeta m3 ON p.ID = m3.post_id AND m3.meta_key = '_gi_seo_generated_at'
WHERE p.post_type = 'grant' 
AND p.post_status = 'publish'
ORDER BY m3.meta_value DESC
LIMIT 10;
```

---

## 🔧 トラブルシューティング

### 問題 1: 処理が途中で止まった

**症状**: 進行状況バーが動かなくなった

**原因**:
- サーバーのタイムアウト
- PHP メモリ不足
- ネットワークエラー

**解決策**:
1. ブラウザをリフレッシュ
2. 「一括更新を開始」ボタンを再度クリック
3. 処理は途中から再開されます（既に処理済みの投稿はスキップ）

---

### 問題 2: 一部の投稿で SEO が生成されない

**症状**: 処理結果に「スキップ: XX件」と表示される

**原因**:
- ACF フィールドが不足している
- 必須データ（地域、金額など）が未入力

**解決策**:
```bash
# スキップされた投稿を手動で確認
WordPress 管理画面 → 助成金 → 投稿一覧
↓
カスタムフィールドで _gi_seo_title が空の投稿を検索
↓
ACF フィールドを補完して「更新」ボタンをクリック
```

---

### 問題 3: 処理後にサイトが重くなった

**症状**: ページの読み込みが遅い

**原因**:
- キャッシュが無効になっている
- データベースクエリが最適化されていない

**解決策**:
```bash
# キャッシュプラグインのキャッシュをクリア
WP Super Cache / W3 Total Cache / WP Rocket など
↓
設定 → キャッシュクリア

# オブジェクトキャッシュの有効化（推奨）
Redis または Memcached の導入を検討
```

---

### 問題 4: Google Search Console でエラーが増えた

**症状**: クロールエラーが急増

**原因**:
- タイトルが重複している
- 説明文が不適切

**解決策**:
```bash
# エラーのあるURLを確認
Google Search Console → カバレッジ → エラーのあるページ
↓
該当ページのSEOタイトル・説明文を手動で修正
↓
Search Console で再インデックスをリクエスト
```

---

## 📊 処理結果記録シート

| 実施日 | 処理件数 | 成功 | スキップ | エラー | 処理時間 | 備考 |
|--------|---------|------|---------|--------|---------|------|
| YYYY-MM-DD | 4,032 | 4,025 | 7 | 0 | 38分 | |

---

## 🎯 期待される効果

### CTR 改善目標
- **現在**: 0.82% (Google Search Console データ)
- **目標**: 3.5〜4.5%
- **予測期間**: 実装後 2〜4週間で効果が表れ始める

### 測定方法
```bash
Google Search Console
↓
検索パフォーマンス
↓
日付範囲: 過去28日間
↓
平均CTRを確認

# 週次でCTRを記録
```

### CTR 追跡シート

| 週 | 平均CTR | 表示回数 | クリック数 | 改善率 | 備考 |
|----|---------|---------|-----------|--------|------|
| Week 0（実装前） | 0.82% | 50,000 | 410 | - | ベースライン |
| Week 1 | __%  | _____ | _____ | __% | |
| Week 2 | __%  | _____ | _____ | __% | |
| Week 3 | __%  | _____ | _____ | __% | |
| Week 4 | __%  | _____ | _____ | __% | 目標: 3.5% |

---

## ✅ 完了チェックリスト

### 実行前
- [ ] データベースバックアップを取得
- [ ] テスト環境で動作確認済み
- [ ] サーバーのタイムアウト設定を確認
- [ ] 処理時間を確保（約40〜60分）

### 実行中
- [ ] ブラウザを開いたまま待機
- [ ] エラーメッセージがないことを確認
- [ ] 進行状況が正常に進んでいることを確認

### 実行後
- [ ] 処理完了メッセージを確認
- [ ] ランダムサンプリング確認（10〜20件）
- [ ] フロントエンド表示確認（5〜10ページ）
- [ ] Google Rich Results Test で確認
- [ ] Google Search Console で確認
- [ ] CTR 追跡を開始

---

## 📞 サポート

問題が発生した場合は、以下の情報を記録してください：

1. エラーメッセージ全文
2. 処理が止まった時点の件数
3. ブラウザのコンソールログ（F12 → Console）
4. サーバーのエラーログ（`/path/to/wordpress/wp-content/debug.log`）

---

## 🎉 成功後の次のステップ

1. **CTR モニタリング**: 週次で Google Search Console のデータを確認
2. **A/B テスト**: タイトルパターンを調整して効果を測定
3. **継続改善**: ユーザーの反応を見ながらテンプレートを最適化

---

**実装完了おめでとうございます！🎊**

SEO 最適化により、助成金情報がより多くのユーザーに届くようになります。
